function Rr(j,An){return An.forEach(function(B){B&&typeof B!="string"&&!Array.isArray(B)&&Object.keys(B).forEach(function(W){if(W!=="default"&&!(W in j)){var p=Object.getOwnPropertyDescriptor(B,W);Object.defineProperty(j,W,p.get?p:{enumerable:!0,get:function(){return B[W]}})}})}),Object.freeze(j)}var Nr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mr(j){return j&&j.__esModule&&Object.prototype.hasOwnProperty.call(j,"default")?j.default:j}var ar={exports:{}},ur={exports:{}};(function(j,An){(function(B,W){j.exports=W()})(typeof self<"u"?self:Nr,function(){return function(B){var W={};function p(g){if(W[g])return W[g].exports;var E=W[g]={i:g,l:!1,exports:{}};return B[g].call(E.exports,E,E.exports,p),E.l=!0,E.exports}return p.m=B,p.c=W,p.d=function(g,E,J){p.o(g,E)||Object.defineProperty(g,E,{enumerable:!0,get:J})},p.r=function(g){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},p.t=function(g,E){if(1&E&&(g=p(g)),8&E||4&E&&typeof g=="object"&&g&&g.__esModule)return g;var J=Object.create(null);if(p.r(J),Object.defineProperty(J,"default",{enumerable:!0,value:g}),2&E&&typeof g!="string")for(var Q in g)p.d(J,Q,(function(un){return g[un]}).bind(null,Q));return J},p.n=function(g){var E=g&&g.__esModule?function(){return g.default}:function(){return g};return p.d(E,"a",E),E},p.o=function(g,E){return{}.hasOwnProperty.call(g,E)},p.p="",p(p.s=0)}([function(B,W,p){p.r(W),p.d(W,"Promise",function(){return x}),p.d(W,"TYPES",function(){return zr}),p.d(W,"ProxyWindow",function(){return T}),p.d(W,"setup",function(){return ir}),p.d(W,"destroy",function(){return Ir}),p.d(W,"serializeMessage",function(){return Pr}),p.d(W,"deserializeMessage",function(){return Or}),p.d(W,"createProxyWindow",function(){return Ar}),p.d(W,"toProxyWindow",function(){return Dr}),p.d(W,"on",function(){return V}),p.d(W,"once",function(){return br}),p.d(W,"send",function(){return U}),p.d(W,"markWindowKnown",function(){return Kn}),p.d(W,"cleanUpWindow",function(){return jr}),p.d(W,"bridge",function(){});function g(n){return{}.toString.call(n)==="[object RegExp]"}var E=`Call was rejected by callee.\r
`;function J(n){return n===void 0&&(n=window),n.location.protocol}function Q(n){if(n===void 0&&(n=window),n.mockDomain){var e=n.mockDomain.split("//")[0];if(e)return e}return J(n)}function un(n){return n===void 0&&(n=window),Q(n)==="about:"}function Z(n){if(n===void 0&&(n=window),n)try{if(n.parent&&n.parent!==n)return n.parent}catch{}}function Dn(n){if(n===void 0&&(n=window),n&&!Z(n))try{return n.opener}catch{}}function cn(n){try{return!0}catch{}return!1}function sn(n){n===void 0&&(n=window);var e=n.location;if(!e)throw new Error("Can not read window location");var r=J(n);if(!r)throw new Error("Can not read window protocol");if(r==="file:")return"file://";if(r==="about:"){var t=Z(n);return t&&cn()?sn(t):"about://"}var o=e.host;if(!o)throw new Error("Can not read window host");return r+"//"+o}function R(n){n===void 0&&(n=window);var e=sn(n);return e&&n.mockDomain&&n.mockDomain.indexOf("mock:")===0?n.mockDomain:e}function G(n){if(!function(e){try{if(e===window)return!0}catch{}try{var r=Object.getOwnPropertyDescriptor(e,"location");if(r&&r.enumerable===!1)return!1}catch{}try{if(un(e)&&cn())return!0}catch{}try{if(function(t){return t===void 0&&(t=window),Q(t)==="mock:"}(e)&&cn())return!0}catch{}try{if(sn(e)===sn(window))return!0}catch{}return!1}(n))return!1;try{if(n===window||un(n)&&cn()||R(window)===R(n))return!0}catch{}return!1}function fn(n){if(!G(n))throw new Error("Expected window to be same domain");return n}function In(n,e){if(!n||!e)return!1;var r=Z(e);return r?r===n:function(t){var o=[];try{for(;t.parent!==t;)o.push(t.parent),t=t.parent}catch{}return o}(e).indexOf(n)!==-1}function zn(n){var e=[],r;try{r=n.frames}catch{r=n}var t;try{t=r.length}catch{}if(t===0)return e;if(t){for(var o=0;o<t;o++){var i=void 0;try{i=r[o]}catch{continue}e.push(i)}return e}for(var a=0;a<100;a++){var s=void 0;try{s=r[a]}catch{return e}if(!s)return e;e.push(s)}return e}var sr=[],fr=[];function L(n,e){e===void 0&&(e=!0);try{if(n===window)return!1}catch{return!0}try{if(!n)return!0}catch{return!0}try{if(n.closed)return!0}catch(o){return!o||o.message!==E}if(e&&G(n))try{if(n.mockclosed)return!0}catch{}try{if(!n.parent||!n.top)return!0}catch{}var r=function(o,i){for(var a=0;a<o.length;a++)try{if(o[a]===i)return a}catch{}return-1}(sr,n);if(r!==-1){var t=fr[r];if(t&&function(o){if(!o.contentWindow||!o.parentNode)return!0;var i=o.ownerDocument;if(i&&i.documentElement&&!i.documentElement.contains(o)){for(var a=o;a.parentNode&&a.parentNode!==a;)a=a.parentNode;if(!a.host||!i.documentElement.contains(a.host))return!0}return!1}(t))return!0}return!1}function jn(n){return n===void 0&&(n=window),Dn(n=n||window)||Z(n)||void 0}function X(n,e){if(typeof n=="string"){if(typeof e=="string")return n==="*"||e===n;if(g(e)||Array.isArray(e))return!1}return g(n)?g(e)?n.toString()===e.toString():!Array.isArray(e)&&!!e.match(n):!!Array.isArray(n)&&(Array.isArray(e)?JSON.stringify(n)===JSON.stringify(e):!g(e)&&n.some(function(r){return X(r,e)}))}function dn(n){try{if(n===window)return!0}catch(e){if(e&&e.message===E)return!0}try{if({}.toString.call(n)==="[object Window]")return!0}catch(e){if(e&&e.message===E)return!0}try{if(window.Window&&n instanceof window.Window)return!0}catch(e){if(e&&e.message===E)return!0}try{if(n&&n.self===n)return!0}catch(e){if(e&&e.message===E)return!0}try{if(n&&n.parent===n)return!0}catch(e){if(e&&e.message===E)return!0}try{if(n&&n.top===n)return!0}catch(e){if(e&&e.message===E)return!0}try{if(n&&n.__cross_domain_utils_window_check__==="__unlikely_value__")return!1}catch{return!0}try{if("postMessage"in n&&"self"in n&&"location"in n)return!0}catch{}return!1}function Rn(n){if(G(n))return fn(n).frameElement;for(var e=0,r=document.querySelectorAll("iframe");e<r.length;e++){var t=r[e];if(t&&t.contentWindow&&t.contentWindow===n)return t}}function dr(n){if(function(r){return r===void 0&&(r=window),!!Z(r)}(n)){var e=Rn(n);if(e&&e.parentElement){e.parentElement.removeChild(e);return}}try{n.close()}catch{}}function q(n){try{if(!n)return!1;if(typeof Promise<"u"&&n instanceof Promise)return!0;if(typeof window<"u"&&typeof window.Window=="function"&&n instanceof window.Window||typeof window<"u"&&typeof window.constructor=="function"&&n instanceof window.constructor)return!1;var e={}.toString;if(e){var r=e.call(n);if(r==="[object Window]"||r==="[object global]"||r==="[object DOMWindow]")return!1}if(typeof n.then=="function")return!0}catch{return!1}return!1}var Nn=[],k=[],mn=0,$;function Mn(){if(!mn&&$){var n=$;$=null,n.resolve()}}function pn(){mn+=1}function _(){mn-=1,Mn()}var x=function(){function n(r){var t=this;if(this.resolved=void 0,this.rejected=void 0,this.errorHandled=void 0,this.value=void 0,this.error=void 0,this.handlers=void 0,this.dispatching=void 0,this.stack=void 0,this.resolved=!1,this.rejected=!1,this.errorHandled=!1,this.handlers=[],r){var o,i,a=!1,s=!1,c=!1;pn();try{r(function(u){c?t.resolve(u):(a=!0,o=u)},function(u){c?t.reject(u):(s=!0,i=u)})}catch(u){_(),this.reject(u);return}_(),c=!0,a?this.resolve(o):s&&this.reject(i)}}var e=n.prototype;return e.resolve=function(r){if(this.resolved||this.rejected)return this;if(q(r))throw new Error("Can not resolve promise with another promise");return this.resolved=!0,this.value=r,this.dispatch(),this},e.reject=function(r){var t=this;if(this.resolved||this.rejected)return this;if(q(r))throw new Error("Can not reject promise with another promise");if(!r){var o=r&&typeof r.toString=="function"?r.toString():{}.toString.call(r);r=new Error("Expected reject to be called with Error, got "+o)}return this.rejected=!0,this.error=r,this.errorHandled||setTimeout(function(){t.errorHandled||function(i,a){if(Nn.indexOf(i)===-1){Nn.push(i),setTimeout(function(){throw i},1);for(var s=0;s<k.length;s++)k[s](i,a)}}(r,t)},1),this.dispatch(),this},e.asyncReject=function(r){return this.errorHandled=!0,this.reject(r),this},e.dispatch=function(){var r=this.resolved,t=this.rejected,o=this.handlers;if(!this.dispatching&&(r||t)){this.dispatching=!0,pn();for(var i=function(h,m){return h.then(function(v){m.resolve(v)},function(v){m.reject(v)})},a=0;a<o.length;a++){var s=o[a],c=s.onSuccess,u=s.onError,l=s.promise,f=void 0;if(r)try{f=c?c(this.value):this.value}catch(h){l.reject(h);continue}else if(t){if(!u){l.reject(this.error);continue}try{f=u(this.error)}catch(h){l.reject(h);continue}}if(f instanceof n&&(f.resolved||f.rejected)){var d=f;d.resolved?l.resolve(d.value):l.reject(d.error),d.errorHandled=!0}else q(f)?f instanceof n&&(f.resolved||f.rejected)?f.resolved?l.resolve(f.value):l.reject(f.error):i(f,l):l.resolve(f)}o.length=0,this.dispatching=!1,_()}},e.then=function(r,t){if(r&&typeof r!="function"&&!r.call)throw new Error("Promise.then expected a function for success handler");if(t&&typeof t!="function"&&!t.call)throw new Error("Promise.then expected a function for error handler");var o=new n;return this.handlers.push({promise:o,onSuccess:r,onError:t}),this.errorHandled=!0,this.dispatch(),o},e.catch=function(r){return this.then(void 0,r)},e.finally=function(r){if(r&&typeof r!="function"&&!r.call)throw new Error("Promise.finally expected a function");return this.then(function(t){return n.try(r).then(function(){return t})},function(t){return n.try(r).then(function(){throw t})})},e.timeout=function(r,t){var o=this;if(this.resolved||this.rejected)return this;var i=setTimeout(function(){o.resolved||o.rejected||o.reject(t||new Error("Promise timed out after "+r+"ms"))},r);return this.then(function(a){return clearTimeout(i),a})},e.toPromise=function(){if(typeof Promise>"u")throw new TypeError("Could not find Promise");return Promise.resolve(this)},e.lazy=function(){return this.errorHandled=!0,this},n.resolve=function(r){return r instanceof n?r:q(r)?new n(function(t,o){return r.then(t,o)}):new n().resolve(r)},n.reject=function(r){return new n().reject(r)},n.asyncReject=function(r){return new n().asyncReject(r)},n.all=function(r){var t=new n,o=r.length,i=[].slice();if(!o)return t.resolve(i),t;for(var a=function(u,l,f){return l.then(function(d){i[u]=d,(o-=1)==0&&t.resolve(i)},function(d){f.reject(d)})},s=0;s<r.length;s++){var c=r[s];if(c instanceof n){if(c.resolved){i[s]=c.value,o-=1;continue}}else if(!q(c)){i[s]=c,o-=1;continue}a(s,n.resolve(c),t)}return o===0&&t.resolve(i),t},n.hash=function(r){var t={},o=[],i=function(s){if(r.hasOwnProperty(s)){var c=r[s];q(c)?o.push(c.then(function(u){t[s]=u})):t[s]=c}};for(var a in r)i(a);return n.all(o).then(function(){return t})},n.map=function(r,t){return n.all(r.map(t))},n.onPossiblyUnhandledException=function(r){return function(t){return k.push(t),{cancel:function(){k.splice(k.indexOf(t),1)}}}(r)},n.try=function(r,t,o){if(r&&typeof r!="function"&&!r.call)throw new Error("Promise.try expected a function");var i;pn();try{i=r.apply(t,o||[])}catch(a){return _(),n.reject(a)}return _(),n.resolve(i)},n.delay=function(r){return new n(function(t){setTimeout(t,r)})},n.isPromise=function(r){return!!(r&&r instanceof n)||q(r)},n.flush=function(){return function(r){var t=$=$||new r;return Mn(),t}(n)},n}();function ln(n,e){for(var r=0;r<n.length;r++)try{if(n[r]===e)return r}catch{}return-1}var gn=function(){function n(){if(this.name=void 0,this.weakmap=void 0,this.keys=void 0,this.values=void 0,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__",function(){if(typeof WeakMap>"u"||Object.freeze===void 0)return!1;try{var r=new WeakMap,t={};return Object.freeze(t),r.set(t,"__testvalue__"),r.get(t)==="__testvalue__"}catch{return!1}}())try{this.weakmap=new WeakMap}catch{}this.keys=[],this.values=[]}var e=n.prototype;return e._cleanupClosedWindows=function(){for(var r=this.weakmap,t=this.keys,o=0;o<t.length;o++){var i=t[o];if(dn(i)&&L(i)){if(r)try{r.delete(i)}catch{}t.splice(o,1),this.values.splice(o,1),o-=1}}},e.isSafeToReadWrite=function(r){return!dn(r)},e.set=function(r,t){if(!r)throw new Error("WeakMap expected key");var o=this.weakmap;if(o)try{o.set(r,t)}catch{delete this.weakmap}if(this.isSafeToReadWrite(r))try{var i=this.name,a=r[i];a&&a[0]===r?a[1]=t:Object.defineProperty(r,i,{value:[r,t],writable:!0});return}catch{}this._cleanupClosedWindows();var s=this.keys,c=this.values,u=ln(s,r);u===-1?(s.push(r),c.push(t)):c[u]=t},e.get=function(r){if(!r)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{if(t.has(r))return t.get(r)}catch{delete this.weakmap}if(this.isSafeToReadWrite(r))try{var o=r[this.name];return o&&o[0]===r?o[1]:void 0}catch{}this._cleanupClosedWindows();var i=ln(this.keys,r);if(i!==-1)return this.values[i]},e.delete=function(r){if(!r)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{t.delete(r)}catch{delete this.weakmap}if(this.isSafeToReadWrite(r))try{var o=r[this.name];o&&o[0]===r&&(o[0]=o[1]=void 0)}catch{}this._cleanupClosedWindows();var i=this.keys,a=ln(i,r);a!==-1&&(i.splice(a,1),this.values.splice(a,1))},e.has=function(r){if(!r)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{if(t.has(r))return!0}catch{delete this.weakmap}if(this.isSafeToReadWrite(r))try{var o=r[this.name];return!(!o||o[0]!==r)}catch{}return this._cleanupClosedWindows(),ln(this.keys,r)!==-1},e.getOrSet=function(r,t){if(this.has(r))return this.get(r);var o=t();return this.set(r,o),o},n}();function Cn(n){return n.name||n.__name__||n.displayName||"anonymous"}function Tn(n,e){try{delete n.name,n.name=e}catch{}return n.__name__=n.displayName=e,n}function H(){var n="0123456789abcdef";return"uid_"+"xxxxxxxxxx".replace(/./g,function(){return n.charAt(Math.floor(Math.random()*n.length))})+"_"+function(e){if(typeof btoa=="function")return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(r,t){return String.fromCharCode(parseInt(t,16))})).replace(/[=]/g,"");if(typeof Buffer<"u")return Buffer.from(e,"utf8").toString("base64").replace(/[=]/g,"");throw new Error("Can not find window.btoa or Buffer")}(new Date().toISOString().slice(11,19).replace("T",".")).replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}var hn;function Ln(n){try{return JSON.stringify([].slice.call(n),function(e,r){return typeof r=="function"?"memoize["+function(t){if(hn=hn||new gn,t==null||typeof t!="object"&&typeof t!="function")throw new Error("Invalid object");var o=hn.get(t);return o||(o=typeof t+":"+H(),hn.set(t,o)),o}(r)+"]":typeof window<"u"&&r instanceof window.Element||r!==null&&typeof r=="object"&&r.nodeType===1&&typeof r.style=="object"&&typeof r.ownerDocument=="object"?{}:r})}catch{throw new Error("Arguments not serializable -- can not be used to memoize")}}function lr(){return{}}var nn=0,Fn=0;function rn(n,e){e===void 0&&(e={});var r=e.thisNamespace,t=r!==void 0&&r,o=e.time,i,a,s=nn;nn+=1;var c=function(){for(var u=arguments.length,l=new Array(u),f=0;f<u;f++)l[f]=arguments[f];s<Fn&&(i=null,a=null,s=nn,nn+=1);var d;d=t?(a=a||new gn).getOrSet(this,lr):i=i||{};var h;try{h=Ln(l)}catch{return n.apply(this,arguments)}var m=d[h];if(m&&o&&Date.now()-m.time<o&&(delete d[h],m=null),m)return m.value;var v=Date.now(),w=n.apply(this,arguments);return d[h]={time:v,value:w},w};return c.reset=function(){i=null,a=null},Tn(c,(e.name||Cn(n))+"::memoized")}rn.clear=function(){Fn=nn};function hr(n){var e={};function r(){for(var t=arguments,o=this,i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];var c=Ln(a);return e.hasOwnProperty(c)||(e[c]=x.try(function(){return n.apply(o,t)}).finally(function(){delete e[c]})),e[c]}return r.reset=function(){e={}},Tn(r,Cn(n)+"::promiseMemoized")}function Y(){}function en(n,e){if(e===void 0&&(e=1),e>=3)return"stringifyError stack overflow";try{if(!n)return"<unknown error: "+{}.toString.call(n)+">";if(typeof n=="string")return n;if(n instanceof Error){var r=n&&n.stack,t=n&&n.message;if(r&&t)return r.indexOf(t)!==-1?r:t+`
`+r;if(r)return r;if(t)return t}return n&&n.toString&&typeof n.toString=="function"?n.toString():{}.toString.call(n)}catch(o){return"Error while stringifying error: "+en(o,e+1)}}function Bn(n){return typeof n=="string"?n:n.toString&&typeof n.toString=="function"?n.toString():{}.toString.call(n)}rn(function(n){if(Object.values)return Object.values(n);var e=[];for(var r in n)n.hasOwnProperty(r)&&e.push(n[r]);return e});function yn(n){return{}.toString.call(n)==="[object RegExp]"}function tn(n,e,r){if(n.hasOwnProperty(e))return n[e];var t=r();return n[e]=t,t}function Hn(){var n=document.body;if(!n)throw new Error("Body element not found");return n}function Jn(){return!!document.body&&document.readyState==="complete"}function Un(){return!!document.body&&document.readyState==="interactive"}rn(function(){return new x(function(n){if(Jn()||Un())return n();var e=setInterval(function(){if(Jn()||Un())return clearInterval(e),n()},10)})});var vn=typeof document<"u"?document.currentScript:null,vr=rn(function(){if(vn||(vn=function(){try{var n=function(){try{throw new Error("_")}catch(a){return a.stack||""}}(),e=/.*at [^(]*\((.*):(.+):(.+)\)$/gi.exec(n),r=e&&e[1];if(!r)return;for(var t=0,o=[].slice.call(document.getElementsByTagName("script")).reverse();t<o.length;t++){var i=o[t];if(i.src&&i.src===r)return i}}catch{}}()))return vn;throw new Error("Can not determine current script")}),wr=H();rn(function(){var n;try{n=vr()}catch{return wr}var e=n.getAttribute("data-uid");if(e&&typeof e=="string"||(e=n.getAttribute("data-uid-auto"))&&typeof e=="string")return e;if(n.src){var r=function(t){for(var o="",i=0;i<t.length;i++){var a=t[i].charCodeAt(0)*i;t[i+1]&&(a+=t[i+1].charCodeAt(0)*(i-1)),o+=String.fromCharCode(97+Math.abs(a)%26)}return o}(JSON.stringify({src:n.src,dataset:n.dataset}));e="uid_"+r.slice(r.length-30)}else e=H();return n.setAttribute("data-uid-auto",e),e});function on(n){n===void 0&&(n=window);var e="__post_robot_10_0_46__";return n!==window?n[e]:n[e]=n[e]||{}}var Zn=function(){return{}};function I(n,e){return n===void 0&&(n="store"),e===void 0&&(e=Zn),tn(on(),n,function(){var r=e();return{has:function(t){return r.hasOwnProperty(t)},get:function(t,o){return r.hasOwnProperty(t)?r[t]:o},set:function(t,o){return r[t]=o,o},del:function(t){delete r[t]},getOrSet:function(t,o){return tn(r,t,o)},reset:function(){r=e()},keys:function(){return Object.keys(r)}}})}var mr=function(){};function wn(){var n=on();return n.WINDOW_WILDCARD=n.WINDOW_WILDCARD||new mr,n.WINDOW_WILDCARD}function N(n,e){return n===void 0&&(n="store"),e===void 0&&(e=Zn),I("windowStore").getOrSet(n,function(){var r=new gn,t=function(o){return r.getOrSet(o,e)};return{has:function(o){return t(o).hasOwnProperty(n)},get:function(o,i){var a=t(o);return a.hasOwnProperty(n)?a[n]:i},set:function(o,i){return t(o)[n]=i,i},del:function(o){delete t(o)[n]},getOrSet:function(o,i){return tn(t(o),n,i)}}})}function Gn(){return I("instance").getOrSet("instanceID",H)}function qn(n,e){var r=e.domain,t=N("helloPromises"),o=t.get(n);o&&o.resolve({domain:r});var i=x.resolve({domain:r});return t.set(n,i),i}function Wn(n,e){return(0,e.send)(n,"postrobot_hello",{instanceID:Gn()},{domain:"*",timeout:-1}).then(function(r){var t=r.origin,o=r.data.instanceID;return qn(n,{domain:t}),{win:n,domain:t,instanceID:o}})}function Yn(n,e){var r=e.send;return N("windowInstanceIDPromises").getOrSet(n,function(){return Wn(n,{send:r}).then(function(t){return t.instanceID})})}function Kn(n){N("knownWindows").set(n,!0)}function En(n){return typeof n=="object"&&n!==null&&typeof n.__type__=="string"}function Vn(n){return n===void 0?"undefined":n===null?"null":Array.isArray(n)?"array":typeof n=="function"?"function":typeof n=="object"?n instanceof Error?"error":typeof n.then=="function"?"promise":{}.toString.call(n)==="[object RegExp]"?"regex":{}.toString.call(n)==="[object Date]"?"date":"object":typeof n=="string"?"string":typeof n=="number"?"number":typeof n=="boolean"?"boolean":void 0}function K(n,e){return{__type__:n,__val__:e}}var M,pr=((M={}).function=function(){},M.error=function(n){return K("error",{message:n.message,stack:n.stack,code:n.code,data:n.data})},M.promise=function(){},M.regex=function(n){return K("regex",n.source)},M.date=function(n){return K("date",n.toJSON())},M.array=function(n){return n},M.object=function(n){return n},M.string=function(n){return n},M.number=function(n){return n},M.boolean=function(n){return n},M.null=function(n){return n},M[void 0]=function(n){return K("undefined",n)},M),gr={},C,yr=((C={}).function=function(){throw new Error("Function serialization is not implemented; nothing to deserialize")},C.error=function(n){var e=n.stack,r=n.code,t=n.data,o=new Error(n.message);return o.code=r,t&&(o.data=t),o.stack=e+`

`+o.stack,o},C.promise=function(){throw new Error("Promise serialization is not implemented; nothing to deserialize")},C.regex=function(n){return new RegExp(n)},C.date=function(n){return new Date(n)},C.array=function(n){return n},C.object=function(n){return n},C.string=function(n){return n},C.number=function(n){return n},C.boolean=function(n){return n},C.null=function(n){return n},C[void 0]=function(){},C),Wr={};new x(function(n){if(window.document&&window.document.body)return n(window.document.body);var e=setInterval(function(){if(window.document&&window.document.body)return clearInterval(e),n(window.document.body)},10)});function xn(){for(var n=I("idToProxyWindow"),e=0,r=n.keys();e<r.length;e++){var t=r[e];n.get(t).shouldClean()&&n.del(t)}}function Xn(n,e){var r=e.send,t=e.id,o=t===void 0?H():t,i=n.then(function(c){if(G(c))return fn(c).name}),a=n.then(function(c){if(L(c))throw new Error("Window is closed, can not determine type");return Dn(c)?"popup":"iframe"});i.catch(Y),a.catch(Y);var s=function(){return n.then(function(c){if(!L(c))return G(c)?fn(c).name:i})};return{id:o,getType:function(){return a},getInstanceID:hr(function(){return n.then(function(c){return Yn(c,{send:r})})}),close:function(){return n.then(dr)},getName:s,focus:function(){return n.then(function(c){c.focus()})},isClosed:function(){return n.then(function(c){return L(c)})},setLocation:function(c,u){return u===void 0&&(u={}),n.then(function(l){var f=window.location.protocol+"//"+window.location.host,d=u.method,h=d===void 0?"get":d,m=u.body;if(c.indexOf("/")===0)c=""+f+c;else if(!c.match(/^https?:\/\//)&&c.indexOf(f)!==0)throw new Error("Expected url to be http or https url, or absolute path, got "+JSON.stringify(c));if(h==="post")return s().then(function(v){if(!v)throw new Error("Can not post to window without target name");(function(w){var S=w.url,D=w.target,P=w.body,b=w.method,z=b===void 0?"post":b,y=document.createElement("form");if(y.setAttribute("target",D),y.setAttribute("method",z),y.setAttribute("action",S),y.style.display="none",P)for(var O=0,F=Object.keys(P);O<F.length;O++){var A,an=F[O],On=document.createElement("input");On.setAttribute("name",an),On.setAttribute("value",(A=P[an])==null?void 0:A.toString()),y.appendChild(On)}Hn().appendChild(y),y.submit(),Hn().removeChild(y)})({url:c,target:v,method:h,body:m})});if(h!=="get")throw new Error("Unsupported method: "+h);if(G(l))try{if(l.location&&typeof l.location.replace=="function"){l.location.replace(c);return}}catch{}l.location=c})},setName:function(c){return n.then(function(u){var l=G(u),f=Rn(u);if(!l)throw new Error("Can not set name for cross-domain window: "+c);fn(u).name=c,f&&f.setAttribute("name",c),i=x.resolve(c)})}}}var T=function(){function n(r){var t=r.send,o=r.win,i=r.serializedWindow;this.id=void 0,this.isProxyWindow=!0,this.serializedWindow=void 0,this.actualWindow=void 0,this.actualWindowPromise=void 0,this.send=void 0,this.name=void 0,this.actualWindowPromise=new x,this.serializedWindow=i||Xn(this.actualWindowPromise,{send:t}),I("idToProxyWindow").set(this.getID(),this),o&&this.setWindow(o,{send:t})}var e=n.prototype;return e.getID=function(){return this.serializedWindow.id},e.getType=function(){return this.serializedWindow.getType()},e.isPopup=function(){return this.getType().then(function(r){return r==="popup"})},e.setLocation=function(r,t){var o=this;return this.serializedWindow.setLocation(r,t).then(function(){return o})},e.getName=function(){return this.serializedWindow.getName()},e.setName=function(r){var t=this;return this.serializedWindow.setName(r).then(function(){return t})},e.close=function(){var r=this;return this.serializedWindow.close().then(function(){return r})},e.focus=function(){var r=this,t=this.isPopup(),o=this.getName(),i=x.hash({isPopup:t,name:o}).then(function(s){var c=s.name;s.isPopup&&c&&window.open("",c,"noopener")}),a=this.serializedWindow.focus();return x.all([i,a]).then(function(){return r})},e.isClosed=function(){return this.serializedWindow.isClosed()},e.getWindow=function(){return this.actualWindow},e.setWindow=function(r,t){var o=t.send;this.actualWindow=r,this.actualWindowPromise.resolve(this.actualWindow),this.serializedWindow=Xn(this.actualWindowPromise,{send:o,id:this.getID()}),N("winToProxyWindow").set(r,this)},e.awaitWindow=function(){return this.actualWindowPromise},e.matchWindow=function(r,t){var o=this,i=t.send;return x.try(function(){return o.actualWindow?r===o.actualWindow:x.hash({proxyInstanceID:o.getInstanceID(),knownWindowInstanceID:Yn(r,{send:i})}).then(function(a){var s=a.proxyInstanceID===a.knownWindowInstanceID;return s&&o.setWindow(r,{send:i}),s})})},e.unwrap=function(){return this.actualWindow||this},e.getInstanceID=function(){return this.serializedWindow.getInstanceID()},e.shouldClean=function(){return!!(this.actualWindow&&L(this.actualWindow))},e.serialize=function(){return this.serializedWindow},n.unwrap=function(r){return n.isProxyWindow(r)?r.unwrap():r},n.serialize=function(r,t){var o=t.send;return xn(),n.toProxyWindow(r,{send:o}).serialize()},n.deserialize=function(r,t){var o=t.send;return xn(),I("idToProxyWindow").get(r.id)||new n({serializedWindow:r,send:o})},n.isProxyWindow=function(r){return!!(r&&!dn(r)&&r.isProxyWindow)},n.toProxyWindow=function(r,t){var o=t.send;if(xn(),n.isProxyWindow(r))return r;var i=r;return N("winToProxyWindow").get(i)||new n({win:i,send:o})},n}();function Sn(n,e,r,t,o){var i=N("methodStore"),a=I("proxyWindowMethods");T.isProxyWindow(t)?a.set(n,{val:e,name:r,domain:o,source:t}):(a.del(n),i.getOrSet(t,function(){return{}})[n]={domain:o,name:r,val:e,source:t})}function Qn(n,e){var r=N("methodStore"),t=I("proxyWindowMethods");return r.getOrSet(n,function(){return{}})[e]||t.get(e)}function kn(n,e,r,t,o){a=(i={on:o.on,send:o.send}).on,s=i.send,I("builtinListeners").getOrSet("functionCalls",function(){return a("postrobot_method",{domain:"*"},function(l){var f=l.source,d=l.origin,h=l.data,m=h.id,v=h.name,w=Qn(f,m);if(!w)throw new Error("Could not find method '"+v+"' with id: "+h.id+" in "+R(window));var S=w.source,D=w.domain,P=w.val;return x.try(function(){if(!X(D,d))throw new Error("Method '"+h.name+"' domain "+JSON.stringify(yn(w.domain)?w.domain.source:w.domain)+" does not match origin "+d+" in "+R(window));if(T.isProxyWindow(S))return S.matchWindow(f,{send:s}).then(function(b){if(!b)throw new Error("Method call '"+h.name+"' failed - proxy window does not match source in "+R(window))})}).then(function(){return P.apply({source:f,origin:d},h.args)},function(b){return x.try(function(){if(P.onError)return P.onError(b)}).then(function(){throw b.stack&&(b.stack="Remote call to "+v+"("+function(z){return z===void 0&&(z=[]),(y=z,[].slice.call(y)).map(function(O){return typeof O=="string"?"'"+O+"'":O===void 0?"undefined":O===null?"null":typeof O=="boolean"?O.toString():Array.isArray(O)?"[ ... ]":typeof O=="object"?"{ ... }":typeof O=="function"?"() => { ... }":"<"+typeof O+">"}).join(", ");var y}(h.args)+`) failed

`+b.stack),b})}).then(function(b){return{result:b,id:m,name:v}})})});var i,a,s,c=r.__id__||H();n=T.unwrap(n);var u=r.__name__||r.name||t;return typeof u=="string"&&typeof u.indexOf=="function"&&u.indexOf("anonymous::")===0&&(u=u.replace("anonymous::",t+"::")),T.isProxyWindow(n)?(Sn(c,r,u,n,e),n.awaitWindow().then(function(l){Sn(c,r,u,l,e)})):Sn(c,r,u,n,e),K("cross_domain_function",{id:c,name:u})}function $n(n,e,r,t){var o,i=t.on,a=t.send;return function(s,c){c===void 0&&(c=gr);var u=JSON.stringify(s,function(l){var f=this[l];if(En(this))return f;var d=Vn(f);if(!d)return f;var h=c[d]||pr[d];return h?h(f,l):f});return u===void 0?"undefined":u}(r,((o={}).promise=function(s,c){return function(u,l,f,d,h){return K("cross_domain_zalgo_promise",{then:kn(u,l,function(m,v){return f.then(m,v)},d,{on:h.on,send:h.send})})}(n,e,s,c,{on:i,send:a})},o.function=function(s,c){return kn(n,e,s,c,{on:i,send:a})},o.object=function(s){return dn(s)||T.isProxyWindow(s)?K("cross_domain_window",T.serialize(s,{send:a})):s},o))}function _n(n,e,r,t){var o,i=t.send;return function(a,s){if(s===void 0&&(s=Wr),a!=="undefined")return JSON.parse(a,function(c,u){if(En(this))return u;var l,f;if(En(u)?(l=u.__type__,f=u.__val__):(l=Vn(u),f=u),!l)return f;var d=s[l]||yr[l];return d?d(f,c):f})}(r,((o={}).cross_domain_zalgo_promise=function(a){return function(s,c,u){return new x(u.then)}(0,0,a)},o.cross_domain_function=function(a){return function(s,c,u,l){var f=u.id,d=u.name,h=l.send,m=function(w){w===void 0&&(w={});function S(){var D=arguments;return T.toProxyWindow(s,{send:h}).awaitWindow().then(function(P){var b=Qn(P,f);if(b&&b.val!==S)return b.val.apply({source:window,origin:R()},D);var z=[].slice.call(D);return w.fireAndForget?h(P,"postrobot_method",{id:f,name:d,args:z},{domain:c,fireAndForget:!0}):h(P,"postrobot_method",{id:f,name:d,args:z},{domain:c,fireAndForget:!1}).then(function(y){return y.data.result})}).catch(function(P){throw P})}return S.__name__=d,S.__origin__=c,S.__source__=s,S.__id__=f,S.origin=c,S},v=m();return v.fireAndForget=m({fireAndForget:!0}),v}(n,e,a,{send:i})},o.cross_domain_window=function(a){return T.deserialize(a,{send:i})},o))}var bn={};bn.postrobot_post_message=function(n,e,r){r.indexOf("file:")===0&&(r="*"),n.postMessage(e,r)};function Pn(n,e,r,t){var o=t.on,i=t.send;return x.try(function(){var a=N().getOrSet(n,function(){return{}});return a.buffer=a.buffer||[],a.buffer.push(r),a.flush=a.flush||x.flush().then(function(){if(L(n))throw new Error("Window is closed");var s=$n(n,e,((c={}).__post_robot_10_0_46__=a.buffer||[],c),{on:o,send:i}),c;delete a.buffer;for(var u=Object.keys(bn),l=[],f=0;f<u.length;f++){var d=u[f];try{bn[d](n,s,e)}catch(h){l.push(h)}}if(l.length===u.length)throw new Error(`All post-robot messaging strategies failed:

`+l.map(function(h,m){return m+". "+en(h)}).join(`

`))}),a.flush.then(function(){delete a.flush})}).then(Y)}function nr(n){return I("responseListeners").get(n)}function rr(n){I("responseListeners").del(n)}function er(n){return I("erroredResponseListeners").has(n)}function tr(n){var e=n.name,r=n.win,t=n.domain,o=N("requestListeners");if(r==="*"&&(r=null),t==="*"&&(t=null),!e)throw new Error("Name required to get request listener");for(var i=0,a=[r,wn()];i<a.length;i++){var s=a[i];if(s){var c=o.get(s);if(c){var u=c[e];if(u){if(t&&typeof t=="string"){if(u[t])return u[t];if(u.__domain_regex__)for(var l=0,f=u.__domain_regex__;l<f.length;l++){var d=f[l],h=d.listener;if(X(d.regex,t))return h}}if(u["*"])return u["*"]}}}}}function Er(n,e,r,t){var o=t.on,i=t.send,a=tr({name:r.name,win:n,domain:e}),s=r.name==="postrobot_method"&&r.data&&typeof r.data.name=="string"?r.data.name+"()":r.name;function c(u,l,f){return x.flush().then(function(){if(!r.fireAndForget&&!L(n))try{return Pn(n,e,{id:H(),origin:R(window),type:"postrobot_message_response",hash:r.hash,name:r.name,ack:u,data:l,error:f},{on:o,send:i})}catch(d){throw new Error("Send response message failed for "+s+" in "+R()+`

`+en(d))}})}return x.all([x.flush().then(function(){if(!r.fireAndForget&&!L(n))try{return Pn(n,e,{id:H(),origin:R(window),type:"postrobot_message_ack",hash:r.hash,name:r.name},{on:o,send:i})}catch(u){throw new Error("Send ack message failed for "+s+" in "+R()+`

`+en(u))}}),x.try(function(){if(!a)throw new Error("No handler found for post message: "+r.name+" from "+e+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);return a.handler({source:n,origin:e,data:r.data})}).then(function(u){return c("success",u)},function(u){return c("error",null,u)})]).then(Y).catch(function(u){if(a&&a.handleError)return a.handleError(u);throw u})}function xr(n,e,r){if(!er(r.hash)){var t=nr(r.hash);if(!t)throw new Error("No handler found for post message ack for message: "+r.name+" from "+e+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);try{if(!X(t.domain,e))throw new Error("Ack origin "+e+" does not match domain "+t.domain.toString());if(n!==t.win)throw new Error("Ack source does not match registered window")}catch(o){t.promise.reject(o)}t.ack=!0}}function Sr(n,e,r){if(!er(r.hash)){var t=nr(r.hash);if(!t)throw new Error("No handler found for post message response for message: "+r.name+" from "+e+" in "+window.location.protocol+"//"+window.location.host+window.location.pathname);if(!X(t.domain,e))throw new Error("Response origin "+e+" does not match domain "+(o=t.domain,Array.isArray(o)?"("+o.join(" | ")+")":g(o)?"RegExp("+o.toString()+")":o.toString()));var o;if(n!==t.win)throw new Error("Response source does not match registered window");rr(r.hash),r.ack==="error"?t.promise.reject(r.error):r.ack==="success"&&t.promise.resolve({source:n,origin:e,data:r.data})}}function or(n,e){var r=e.on,t=e.send,o=I("receivedMessages");try{if(!window||window.closed||!n.source)return}catch{return}var i=n.source,a=n.origin,s=function(l,f,d,h){var m=h.on,v=h.send,w;try{w=_n(f,d,l,{on:m,send:v})}catch{return}if(w&&typeof w=="object"&&w!==null){var S=w.__post_robot_10_0_46__;if(Array.isArray(S))return S}}(n.data,i,a,{on:r,send:t});if(s){Kn(i);for(var c=0;c<s.length;c++){var u=s[c];if(o.has(u.id)||(o.set(u.id,!0),L(i)&&!u.fireAndForget))return;u.origin.indexOf("file:")===0&&(a="file://");try{u.type==="postrobot_message_request"?Er(i,a,u,{on:r,send:t}):u.type==="postrobot_message_response"?Sr(i,a,u):u.type==="postrobot_message_ack"&&xr(i,a,u)}catch(l){setTimeout(function(){throw l},0)}}}}function V(n,e,r){if(!n)throw new Error("Expected name");if(typeof(e=e||{})=="function"&&(r=e,e={}),!r)throw new Error("Expected handler");var t=function o(i,a){var s=i.name,c=i.win,u=i.domain,l=N("requestListeners");if(!s||typeof s!="string")throw new Error("Name required to add request listener");if(c&&c!=="*"&&T.isProxyWindow(c)){var f=c.awaitWindow().then(function(A){return o({name:s,win:A,domain:u},a)});return{cancel:function(){f.then(function(A){return A.cancel()},Y)}}}var d=c;if(Array.isArray(d)){for(var h=[],m=0,v=d;m<v.length;m++)h.push(o({name:s,domain:u,win:v[m]},a));return{cancel:function(){for(var A=0;A<h.length;A++)h[A].cancel()}}}if(Array.isArray(u)){for(var w=[],S=0,D=u;S<D.length;S++)w.push(o({name:s,win:d,domain:D[S]},a));return{cancel:function(){for(var A=0;A<w.length;A++)w[A].cancel()}}}var P=tr({name:s,win:d,domain:u});d&&d!=="*"||(d=wn());var b=(u=u||"*").toString();if(P)throw d&&u?new Error("Request listener already exists for "+s+" on domain "+u.toString()+" for "+(d===wn()?"wildcard":"specified")+" window"):d?new Error("Request listener already exists for "+s+" for "+(d===wn()?"wildcard":"specified")+" window"):u?new Error("Request listener already exists for "+s+" on domain "+u.toString()):new Error("Request listener already exists for "+s);var z=l.getOrSet(d,function(){return{}}),y=tn(z,s,function(){return{}}),O,F;return yn(u)?(O=tn(y,"__domain_regex__",function(){return[]})).push(F={regex:u,listener:a}):y[b]=a,{cancel:function(){delete y[b],F&&(O.splice(O.indexOf(F,1)),O.length||delete y.__domain_regex__),Object.keys(y).length||delete z[s],d&&!Object.keys(z).length&&l.del(d)}}}({name:n,win:e.window,domain:e.domain||"*"},{handler:r||e.handler,handleError:e.errorHandler||function(o){throw o}});return{cancel:function(){t.cancel()}}}function br(n,e,r){typeof(e=e||{})=="function"&&(r=e,e={});var t=new x,o;return e.errorHandler=function(i){o.cancel(),t.reject(i)},o=V(n,e,function(i){if(o.cancel(),t.resolve(i),r)return r(i)}),t.cancel=o.cancel,t}var U=function n(e,r,t,o){var i=(o=o||{}).domain||"*",a=o.timeout||-1,s=o.timeout||5e3,c=o.fireAndForget||!1;return T.toProxyWindow(e,{send:n}).awaitWindow().then(function(u){return x.try(function(){if(function(l,f,d){if(!l)throw new Error("Expected name");if(typeof d!="string"&&!Array.isArray(d)&&!yn(d))throw new TypeError("Can not send "+l+". Expected domain "+JSON.stringify(d)+" to be a string, array, or regex");if(L(f))throw new Error("Can not send "+l+". Target window is closed")}(r,u,i),function(l,f){var d=jn(f);if(d)return d===l;if(f===l||function(v){v===void 0&&(v=window);try{if(v.top)return v.top}catch{}if(Z(v)===v)return v;try{if(In(window,v)&&window.top)return window.top}catch{}try{if(In(v,window)&&window.top)return window.top}catch{}for(var w=0,S=function P(b){for(var z=[],y=0,O=zn(b);y<O.length;y++){var F=O[y];z.push(F);for(var A=0,an=P(F);A<an.length;A++)z.push(an[A])}return z}(v);w<S.length;w++){var D=S[w];try{if(D.top)return D.top}catch{}if(Z(D)===D)return D}}(f)===f)return!1;for(var h=0,m=zn(l);h<m.length;h++)if(m[h]===f)return!0;return!1}(window,u))return function(l,f,d){f===void 0&&(f=5e3),d===void 0&&(d="Window");var h=function(m){return N("helloPromises").getOrSet(m,function(){return new x})}(l);return f!==-1&&(h=h.timeout(f,new Error(d+" did not load after "+f+"ms"))),h}(u,s)}).then(function(l){return function(f,d,h,m){var v=m.send;return x.try(function(){return typeof d=="string"?d:x.try(function(){return h||Wn(f,{send:v}).then(function(w){return w.domain})}).then(function(w){if(!X(d,d))throw new Error("Domain "+Bn(d)+" does not match "+Bn(d));return w})})}(u,i,(l===void 0?{}:l).domain,{send:n})}).then(function(l){var f=l,d=r==="postrobot_method"&&t&&typeof t.name=="string"?t.name+"()":r,h=new x,m=r+"_"+H();if(!c){var v={name:r,win:u,domain:f,promise:h};(function(y,O){I("responseListeners").set(y,O)})(m,v);var w=N("requestPromises").getOrSet(u,function(){return[]});w.push(h),h.catch(function(){(function(y){I("erroredResponseListeners").set(y,!0)})(m),rr(m)});var S=function(y){return N("knownWindows").get(y,!1)}(u)?1e4:2e3,D=a,P=S,b=D,z=function(y,O){var F;return function A(){F=setTimeout(function(){(function(){if(L(u))return h.reject(new Error("Window closed for "+r+" before "+(v.ack?"response":"ack")));if(v.cancelled)return h.reject(new Error("Response listener was cancelled for "+r));P=Math.max(P-500,0),b!==-1&&(b=Math.max(b-500,0)),v.ack||P!==0?b===0&&h.reject(new Error("No response for postMessage "+d+" in "+R()+" in "+D+"ms")):h.reject(new Error("No ack for postMessage "+d+" in "+R()+" in "+S+"ms"))})(),A()},500)}(),{cancel:function(){clearTimeout(F)}}}();h.finally(function(){z.cancel(),w.splice(w.indexOf(h,1))}).catch(Y)}return Pn(u,f,{id:H(),origin:R(window),type:"postrobot_message_request",hash:m,name:r,data:t,fireAndForget:c},{on:V,send:n}).then(function(){return c?h.resolve():h},function(y){throw new Error("Send request message failed for "+d+" in "+R()+`

`+en(y))})})})};function Pr(n,e,r){return $n(n,e,r,{on:V,send:U})}function Or(n,e,r){return _n(n,e,r,{send:U})}function Ar(n){return new T({send:U,win:n})}function Dr(n){return T.toProxyWindow(n,{send:U})}function ir(){on().initialized||(on().initialized=!0,e=(n={on:V,send:U}).on,r=n.send,(t=on()).receiveMessage=t.receiveMessage||function(o){return or(o,{on:e,send:r})},function(o){var i=o.on,a=o.send;I().getOrSet("postMessageListener",function(){return function(s,c,u){return s.addEventListener("message",u),{cancel:function(){s.removeEventListener("message",u)}}}(window,0,function(s){(function(c,u){var l=u.on,f=u.send;x.try(function(){var d=c.source||c.sourceElement,h=c.origin||c.originalEvent&&c.originalEvent.origin,m=c.data;if(h==="null"&&(h="file://"),d){if(!h)throw new Error("Post message did not have origin domain");or({source:d,origin:h,data:m},{on:l,send:f})}})})(s,{on:i,send:a})})})}({on:V,send:U}),function(o){var i=o.on,a=o.send;I("builtinListeners").getOrSet("helloListener",function(){var s=i("postrobot_hello",{domain:"*"},function(u){return qn(u.source,{domain:u.origin}),{instanceID:Gn()}}),c=jn();return c&&Wn(c,{send:a}).catch(function(u){}),s})}({on:V,send:U}));var n,e,r,t}function Ir(){(function(){for(var e=I("responseListeners"),r=0,t=e.keys();r<t.length;r++){var o=t[r],i=e.get(o);i&&(i.cancelled=!0),e.del(o)}})(),(n=I().get("postMessageListener"))&&n.cancel();var n;delete window.__post_robot_10_0_46__}var zr=!0;function jr(n){for(var e=0,r=N("requestPromises").get(n,[]);e<r.length;e++)r[e].reject(new Error("Window "+(L(n)?"closed":"cleaned up")+" before response")).catch(Y)}ir()}])})})(ur);var Cr=ur.exports;(function(j){j.exports=Cr,j.exports.default=j.exports})(ar);var cr=ar.exports,Tr=Mr(cr),Lr=Rr({__proto__:null,default:Tr},[cr]);export{Lr as i};
